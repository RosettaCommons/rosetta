cd %(workdir)s

# Do the tests actually exist?
[ -x %(bin)s/calibur.%(binext)s ] || exit 1

#Test Vanilla clustering (thres_finder 0)
%(bin)s/calibur.%(binext)s %(additional_flags)s -database %(database)s -pdb_list pdb_list \
-testing:INTEGRATION_TEST 2>&1 | egrep -vf ../../ignore_list > log1 
test "${PIPESTATUS[0]}" != '0' && exit 1 || true

#Test Loop Clustering
%(bin)s/calibur.%(binext)s %(additional_flags)s -database %(database)s -pdb_list pdb_list -start 91 -end 101 \
-testing:INTEGRATION_TEST 2>&1 | egrep -vf ../../ignore_list > log2 
test "${PIPESTATUS[0]}" != '0' && exit 1 || true

#Test Chain Clustering
%(bin)s/calibur.%(binext)s %(additional_flags)s -database %(database)s -pdb_list pdb_list -chain " " \
-testing:INTEGRATION_TEST 2>&1 | egrep -vf ../../ignore_list > log8 
test "${PIPESTATUS[0]}" != '0' && exit 1 || true

#Test Other clustering settings
%(bin)s/calibur.%(binext)s %(additional_flags)s -database %(database)s -pdb_list pdb_list -thres_finder 1 \
    -testing:INTEGRATION_TEST 2>&1 | egrep -vf ../../ignore_list > log3
    test "${PIPESTATUS[0]}" != '0' && exit 1 || true

%(bin)s/calibur.%(binext)s %(additional_flags)s -database %(database)s -pdb_list pdb_list -thres_finder 2 \
    -testing:INTEGRATION_TEST 2>&1 | egrep -vf ../../ignore_list > log4 
test "${PIPESTATUS[0]}" != '0' && exit 1 || true

%(bin)s/calibur.%(binext)s %(additional_flags)s -database %(database)s -pdb_list pdb_list -thres_finder 2 -nofilter \
    -testing:INTEGRATION_TEST 2>&1 | egrep -vf ../../ignore_list > log5 
test "${PIPESTATUS[0]}" != '0' && exit 1 || true

%(bin)s/calibur.%(binext)s %(additional_flags)s -database %(database)s -pdb_list pdb_list -thres_finder 3 \
    -testing:INTEGRATION_TEST 2>&1 | egrep -vf ../../ignore_list > log6 
test "${PIPESTATUS[0]}" != '0' && exit 1 || true

%(bin)s/calibur.%(binext)s %(additional_flags)s -database %(database)s -pdb_list pdb_list -thres_finder 3 -nofilter \
    -testing:INTEGRATION_TEST 2>&1 | egrep -vf ../../ignore_list > log7 
test "${PIPESTATUS[0]}" != '0' && exit 1 || true
